<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.industry.mapper.EnterpriseResourceMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        insert into construction_industry_api.t_enterprise_resource
        ( id
        , is_shared
        , enterprise_name
        , enterprise_qualifications
        , area
        , contact_address
        , contacts
        , sex
        , telephone_number
        , qq_number
        , customer_type
        , follow_up_situation
        , creator_id
        , gmt_create
        , regenerator_id
        , gmt_modified
        , remark)
        values ( #{id}
               , #{shared}
               , #{enterpriseName}
               , #{enterpriseQualifications}
               , #{area}
               , #{contactAddress}
               , #{contacts}
               , #{sex}
               , #{telephoneNumber}
               , #{qqNumber}
               , #{customerType}
               , #{followUpSituation}
               , #{creatorId}
               , #{gmtCreate}
               , #{regeneratorId}
               , #{gmtModified}
               , #{remark})
    </insert>

    <resultMap id="listEnterpriseResourcesMap" type="EnterpriseResourceDO">
        <id column="id" property="id"/>
        <result column="is_shared" property="shared"/>
        <collection
                property="listEnterpriseDemands"
                ofType="EnterpriseResourceDemandDO"
                select="selectSubList"
                column="id">
            <id column="id2" property="id"/>
            <result column="creator_id2" property="creatorId"/>
            <result column="gmt_create2" property="gmtCreate"/>
            <result column="regenerator_id2" property="regeneratorId"/>
            <result column="gmt_modified2" property="gmtModified"/>
        </collection>
    </resultMap>
    <select id="selectSubList" resultType="EnterpriseResourceDemandDO">
        select id
             , enterprise_resource_id
             , level_major_initial_conversion
             , creator_id     as creator_id2
             , gmt_create     as gmt_create2
             , regenerator_id as regenerator_id2
             , gmt_modified   as gmt_modified2
        from construction_industry_api.t_enterprise_resource_demand
        where enterprise_resource_id = #{id}
    </select>

    <select id="listSharedEnterpriseResources" resultMap="listEnterpriseResourcesMap" resultType="EnterpriseResourceDO">
        select id,
               is_shared,
               enterprise_name,
               enterprise_qualifications,
               area,
               contact_address,
               contacts,
               sex,
               telephone_number,
               qq_number,
               customer_type,
               follow_up_situation,
               remark,
               creator_id,
               gmt_create,
               regenerator_id,
               gmt_modified
        from construction_industry_api.t_enterprise_resource
        where is_shared = 1
        order by id desc
    </select>

    <select id="listEnterpriseResources" resultMap="listEnterpriseResourcesMap" resultType="EnterpriseResourceDO">
        select id,
               is_shared,
               enterprise_name,
               enterprise_qualifications,
               area,
               contact_address,
               contacts,
               sex,
               telephone_number,
               qq_number,
               customer_type,
               follow_up_situation,
               remark,
               creator_id,
               gmt_create,
               regenerator_id,
               gmt_modified
        from construction_industry_api.t_enterprise_resource
    </select>

    <resultMap id="listEnterpriseResourceMap" type="EnterpriseResourceDO">
        <id column="id" property="id"/>
        <result column="is_shared" property="shared"/>
        <collection property="listEnterpriseDemands" ofType="EnterpriseResourceDemandDO">
            <id column="id2" property="id"/>
            <result column="creator_id2" property="creatorId"/>
            <result column="gmt_create2" property="gmtCreate"/>
            <result column="regenerator_id2" property="regeneratorId"/>
            <result column="gmt_modified2" property="gmtModified"/>
        </collection>
    </resultMap>

    <select id="getEnterpriseResourceById" resultMap="listEnterpriseResourceMap" resultType="EnterpriseResourceDO">
        select t1.id
             , t1.is_shared
             , t1.enterprise_name
             , t1.enterprise_qualifications
             , t1.area
             , t1.contact_address
             , t1.contacts
             , t1.sex
             , t1.telephone_number
             , t1.qq_number
             , t1.customer_type
             , t1.follow_up_situation
             , t1.remark
             , t1.creator_id
             , t1.gmt_create
             , t1.regenerator_id
             , t1.gmt_modified
             , t2.id             as id2
             , t2.enterprise_resource_id
             , t2.level_major_initial_conversion
             , t2.creator_id     as creator_id2
             , t2.gmt_create     as gmt_create2
             , t2.regenerator_id as regenerator_id2
             , t2.gmt_modified   as gmt_modified2
        from construction_industry_api.t_enterprise_resource as t1
                 left join construction_industry_api.t_enterprise_resource_demand as t2
                           on t1.id = t2.enterprise_resource_id
        where t1.id = #{id}
        order by t1.id desc
    </select>
    <select id="listEnterpriseResourcesByUserId" resultMap="listEnterpriseResourcesMap"
            resultType="EnterpriseResourceDO">
        select id,
               is_shared,
               enterprise_name,
               enterprise_qualifications,
               area,
               contact_address,
               contacts,
               sex,
               telephone_number,
               qq_number,
               customer_type,
               follow_up_situation,
               remark,
               creator_id,
               gmt_create,
               regenerator_id,
               gmt_modified
        from construction_industry_api.t_enterprise_resource
        where creator_id = #{userId}
        order by id desc
    </select>
</mapper>
